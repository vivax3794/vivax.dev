{"_path":"/blog/compiler_1","_dir":"blog","_draft":false,"_partial":false,"_locale":"","title":"Compiler part 1 - How to generate an exe?","description":"So in this little series, I am going to be making a compiler and taking you along every step of the way!","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"compiler-part-1-how-to-generate-an-exe"},"children":[{"type":"text","value":"Compiler part 1 - How to generate an exe?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So in this little series, I am going to be making a compiler and taking you along every step of the way!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To be clear, this won't be a tutorial per se, but I will show you every step along the way."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Also, I am not a professional compiler dev, this is a hobby and from my own experience."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And if you want a better resource for making languages, check out "},{"type":"element","tag":"a","props":{"href":"https://craftinginterpreters.com/","rel":["nofollow"]},"children":[{"type":"text","value":"Crafting Interpreters"}]},{"type":"text","value":", it is free online and goes over making an interpreter in huge detail. And yes I will make a compiler, but a lot of the concepts carry over, so if you ever get confused by this blog might try giving that a read;"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Also having an understanding of Rust or C will help a lot in understanding some of the terms used (like pointer), I will try to explain stuff that isn't commonly known."}]},{"type":"element","tag":"h3","props":{"id":"the-goal"},"children":[{"type":"text","value":"The goal"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We are going to make a compiler in Rust, the lang will be simple with type inference!\nStarting out with just numbers, then moving on to strings and even custom structs and classes.\nFigure out how to make import systems, parse code into an AST (abstract syntax tree), how to resolve type information."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And most importantly how to generate LLVM IR and turn it into an exe that you can run independently."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We will also look a bit at how to create a good CLI interface for our compiler and how to handle errors.\nAnother issue that comes up is testing, if you aren't writing tests for your code you should! Although what is the best way to test a compiler? Well, what I will be doing is adding "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"assert"}]},{"type":"text","value":" statements to our language and running a bunch of smaller programs to see if they fail."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The lang itself is gonna be inspired by Python and Rust! Hence type inference, which means you won't have to declare the types of variables.\nBut arguments and return types you need to. an example of code in the lang might be:"}]},{"type":"element","tag":"pre","props":{"code":"fn add(a: int, b: int) -> int {\n    return a + b;\n}\n\nfn main() {\n    print add(1, 2);\n}\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"fn add(a: int, b: int) -> int {\n    return a + b;\n}\n\nfn main() {\n    print add(1, 2);\n}\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"and yes "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"print"}]},{"type":"text","value":" is gonna be a statement as it makes debugging easier at the start before we have functions!"}]},{"type":"element","tag":"h3","props":{"id":"assembly"},"children":[{"type":"text","value":"Assembly"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So how do we create an exe? Well, we could write all the bytes manually ourselves! But that is a lot of work and most importantly isn't cross-platform "},{"type":"element","tag":"o","props":{},"children":[]},{"type":"text","value":"\nBecause each CPU is gonna have a separate set of assembly instructions, and even on the same CPU model different OSes are going to have different exe formats!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So what do we do? Well, we use LLVM IR."}]},{"type":"element","tag":"h3","props":{"id":"llvm"},"children":[{"type":"text","value":"LLVM"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So what is this magical LLVM IR I speak of? Well, it is a programming lang, well an IR (Intermediate Representation), basically, it is somewhere between assembly and a programming lang. Most langs are converted into some form of IR before then being compiled all the way down to an exe.\nMany compilers also have a lang specific IR that they use before converting to the LLVM IR, and we are going to as well."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And we don't need to generate the LLVM IR text ourselves, there are tools to do it for us making it really convenient! We will be using "},{"type":"element","tag":"a","props":{"href":"https://github.com/TheDan64/inkwell","rel":["nofollow"]},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"inkwell"}]}]},{"type":"text","value":" for this, it wraps the LLVM C library."}]},{"type":"element","tag":"h3","props":{"id":"overall-compiler-structure"},"children":[{"type":"text","value":"Overall compiler structure"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is how we are going to structure our compiler, and over the following blog posts we will work on these parts!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://mermaid.live/edit#pako:eNpNjrsOgzAMRX8l8kz6ARkqVWJBokuLOmWxwBTUPFBwBAjx7w3QoZ6uj4-lu0LtGwIFrfFT3WFgUeXaiTQVzSykvIrbyCdJIQFRLQOJQKM3kXvvDqdwTMGhkUU43T-w__TuM5Exh1uWr7ssHqf3W47DhWaCDCwFi32TSq27o4E7sqRBpdhQi9GwBu22pGJk_1xcDYpDpAzi0CBT3uM7oAXVohlp-wJr-kfl","rel":["nofollow"]},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"https://mermaid.ink/img/pako:eNpNjrsOgzAMRX8l8kz6ARkqVWJBokuLOmWxwBTUPFBwBAjx7w3QoZ6uj4-lu0LtGwIFrfFT3WFgUeXaiTQVzSykvIrbyCdJIQFRLQOJQKM3kXvvDqdwTMGhkUU43T-w__TuM5Exh1uWr7ssHqf3W47DhWaCDCwFi32TSq27o4E7sqRBpdhQi9GwBu22pGJk_1xcDYpDpAzi0CBT3uM7oAXVohlp-wJr-kfl?type=png"},"children":[]}]}]},{"type":"element","tag":"h2","props":{"id":"so-lets-write-some-code"},"children":[{"type":"text","value":"So let's write some code!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"let's just start very simple, we will hardcode some inkwell code to generate a simple \"Hello World\" script, in the next post we will start laying out the code structure of our compiler!"}]},{"type":"element","tag":"h3","props":{"id":"installing-inkwell-and-llvm"},"children":[{"type":"text","value":"Installing inkwell and LLVM"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"***WARNING: ***"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This step takes a while, the first few steps are slow but you can sit thru them fine."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The last build step on the other hand takes a VERY long time, so go watch a movie or something."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The LLVM install below is building from source, it is what I found worked for me, but you should try your package managers LLVM first and if it works then great! you saved yourself a lot of time "},{"type":"element","tag":"d","props":{},"children":[]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"first, we need to add the inkwell library to our project."}]},{"type":"element","tag":"pre","props":{"code":"cargo add inkwell --features llvm15-0\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"cargo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" add"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" inkwell"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" --features"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" llvm15-0\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"now if you try to just run the code you get an error complaining that LLVM is not installed on your system (or maybe you don't in that case skip this step!)\nYou need to install LLVM, I am using Arch so will include instructions for that, but this should work on other Linux systems as well."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We will use "},{"type":"element","tag":"a","props":{"href":"https://crates.io/crates/llvmenv","rel":["nofollow"]},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"llvmenv"}]}]},{"type":"text","value":" to build a local copy of the LLVM source code!"}]},{"type":"element","tag":"pre","props":{"code":"cargo install llvmenv\nllvmenv init\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"cargo"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" install"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" llvmenv\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"llvmenv"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" init\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We will need to clone the LLVM project and switch to the version 15 branch (this is around a 2GB download)"}]},{"type":"element","tag":"pre","props":{"code":"git clone https://github.com/llvm/llvm-project.git\ncd llvm-project\ngit checkout release/15.x\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"git"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" clone"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" https://github.com/llvm/llvm-project.git\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"cd"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" llvm-project\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"git"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" checkout"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" release/15.x\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"then we will need to add this path to the list of LLVM versions "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"llvmenv"}]},{"type":"text","value":" knows about, open the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"llvmenv"}]},{"type":"text","value":" entires file located in "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"~/.config/llvmend/entry.toml"}]},{"type":"text","value":"."}]},{"type":"element","tag":"pre","props":{"code":"[local-15]\npath = \"PATH_TO_YOUR_CLONED_REPO/llvm-project/llvm\"\ntarget = [\"X86\"]\n","language":"toml","meta":"","className":"language-toml shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"local-15"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"path = "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"PATH_TO_YOUR_CLONED_REPO/llvm-project/llvm\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"target = ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"X86\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"]\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Remember to specify where you cloned it, for example for me it is "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"/home/vivax/llvm-project/llvm"}]},{"type":"text","value":" (I just cloned it in my home folder).\nalso, you might need a different value for "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"target"}]},{"type":"text","value":", look at what it says for "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"llvm-mirror"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"now when we do "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"llvmenv entries"}]},{"type":"text","value":" we should see our "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"local-15"}]},{"type":"text","value":" on there, and now we can build it!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is going to take a good while, for me it took an hour."}]},{"type":"element","tag":"pre","props":{"code":"llvmenv build-entry local-15\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"llvmenv"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" build-entry"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" local-15\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now we need to tell cargo where to find our new LLVM build, llvmenv would likely have installed it in "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"~/.local/share/llvmenv/local-15"}]},{"type":"text","value":".\nWe can tell Rust how to find this using the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"LLVM_SYS_150_PREFIX."}]},{"type":"text","value":" env var, you can either export it once:"}]},{"type":"element","tag":"pre","props":{"code":"export LLVM_SYS_150_PREFIX=\"/home/USERNAME/.local/share/llvmenv/local-15\"\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" LLVM_SYS_150_PREFIX"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"/home/USERNAME/.local/share/llvmenv/local-15\"\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Alternatively you can save this in a file so cargo always uses it for this project (although that does make it hard to share the project with others, so be warned)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"create a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":".cargo"}]},{"type":"text","value":" folder in the root of your project, then add a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"config.toml"}]},{"type":"text","value":" file in the folder."}]},{"type":"element","tag":"pre","props":{"code":".cargo/\n    config.toml\nsrc/\n    ...\nCargo.toml\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":".cargo/\n    config.toml\nsrc/\n    ...\nCargo.toml\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"in the file we can set build settings"}]},{"type":"element","tag":"pre","props":{"code":"[env]\nLLVM_SYS_150_PREFIX=\"/home/USERNAME/.local/share/llvmenv/local-15\"\n","language":"toml","meta":"","className":"language-toml shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"env"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"LLVM_SYS_150_PREFIX="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"/home/USERNAME/.local/share/llvmenv/local-15\"\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"that way you don't have to export the path again each time you come back to the project!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now that we got that installed, we can try to run our project again, (you might wanna do "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"cargo clean"}]},{"type":"text","value":" first if you tried to build it earlier)"}]},{"type":"element","tag":"h3","props":{"id":"hello-world"},"children":[{"type":"text","value":"Hello World"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Okay, that was a lot of work (and time) for the first step "}]},{"type":"text","value":"\nBut now we can finally write some code!"},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So we are just gonna do this in "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"main.rs"}]},{"type":"text","value":" as a proof of concept, in the next post we will write a proper code structure with minimal implementations for each part of the compiler, and after that, we will have a technically fully working compiler, although it will be quite minimal. We will also tackle the CLI interface in the next post, so for now lets us just hardcode everything."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"But first, we need to talk about lib-c, the standard library of C, we will be using it as well! You may ask, why are we using the stdlib from another lang, well simple, everybody is! The reason is that libc is implemented on basically any major platform you can imagine, and instead of dealing with OS specific terminal stuff, you can just use "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"printf"}]},{"type":"text","value":" from libc!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"first, we need some imports:"}]},{"type":"element","tag":"pre","props":{"code":"use inkwell::{context::Context, AddressSpace};\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"use inkwell::{context::Context, AddressSpace};\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"now let's get started, we need to create some structs we will use to generate our code."}]},{"type":"element","tag":"pre","props":{"code":"let context = Context::create();\nlet module = context.create_module(\"hello world\");\nlet builder = context.create_builder();\n","language":"rust","meta":"","className":"language-rust shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" context "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" Context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" module "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"create_module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"hello world\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" builder "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"create_builder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"context"}]},{"type":"text","value":" is basically a builder for generic stuff like types."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"module"}]},{"type":"text","value":" is what will contain our definitions and code, think of it as a file!"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"builder"}]},{"type":"text","value":" is what we use to generate code, we need to point it to the correct spot in the module, and we will get to that soon!"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"first let's declare some types we will be using later"}]},{"type":"element","tag":"pre","props":{"code":"let i8_type = context.i8_type();\nlet i8_ptr_type = i8_type.ptr_type(AddressSpace::default());\nlet i32_type = context.i32_type();\n","language":"rust","meta":"","className":"language-rust shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" i8_type "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"i8_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" i8_ptr_type "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" i8_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"ptr_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"AddressSpace"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"());\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" i32_type "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"i32_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We are going to use an "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"i8"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"i32"}]},{"type":"text","value":", and also a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"i8"}]},{"type":"text","value":" pointer.\nThe "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"AddressSpace"}]},{"type":"text","value":" is basically just where in memory the pointer points to, we don't really have any specific requirements for this so the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"::default()"}]},{"type":"text","value":" is fine."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So I mentioned we are going to use "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"printf"}]},{"type":"text","value":", but we need to tell LLVM what the hell "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"printf"}]},{"type":"text","value":" is! When you are linking everything together there is no real concept of scope (except functions), all functions are in the same scope. so when we link with libc we get every function from libc in the global scope, but we need to declare what their types are as LLVM doesn't actually care about what libc is (with one exception, it does do optimizations around malloc/free)."}]},{"type":"element","tag":"pre","props":{"code":"let printf_type = i32_type.fn_type(&[i8_ptr_type.into()], true);\nlet printf = module.add_function(\"printf\", printf_type, None);\n","language":"rust","meta":"","className":"language-rust shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" printf_type "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" i32_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"fn_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"[i8_ptr_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"into"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"()], "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" printf "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"add_function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"printf\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":", printf_type, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"so let's break this down, "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"printf_type"}]},{"type":"text","value":" is basically the function signature, and what that line is saying is basically:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"The first parameter is an "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"i8"}]},{"type":"text","value":" pointer, which is actually a string, a string is really just an array of characters, or "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"u8"}]},{"type":"text","value":" (but we don't have unsigned types in LLVM, so "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"i8"}]},{"type":"text","value":" it is)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"It then takes a variable amount of arguments, that is what the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":" is signaling."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"It then returns an "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"i32"}]},{"type":"text","value":", which is rarely used, but represents how many chars were written, or a negative number for error."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"then we add the function declaration to the module, under the name "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"printf"}]},{"type":"text","value":", using the type we defined in the line above, the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"None"}]},{"type":"text","value":" is the linking option, for which we just leave it at default."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Have you ever wondered why basically every lang uses "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"main"}]},{"type":"text","value":"? well, there is a reason! Did you know that the actual entry point to your program isn't "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"main"}]},{"type":"text","value":"? it is "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"_start"}]},{"type":"text","value":"? libc defines a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"_start"}]},{"type":"text","value":" function for us, it does some setup like reading arguments, then it calls "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"main()"}]},{"type":"text","value":" and then calls "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"exit()"}]},{"type":"text","value":" with mains return code!\nSo if you wanted to create a lang without libc (like if you are targeting embedded systems) you need to define "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"_start"}]},{"type":"text","value":" instead!\nBut that is just some trivia for you, we are using libc, so we will define a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"main()"}]},{"type":"text","value":" function."}]},{"type":"element","tag":"pre","props":{"code":"let main_function_type = i8_type.fn_type(&[], false);\nlet main_function = module.add_function(\"main\", main_function_type, None);\n","language":"rust","meta":"","className":"language-rust shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" main_function_type "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" i8_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"fn_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"[], "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" main_function "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"add_function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"main\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":", main_function_type, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"this is very similar to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"printf"}]},{"type":"text","value":", our return type is an "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"i8"}]},{"type":"text","value":", which will be the program's exit code, and we take no arguments.\nnow we can start generating our code!"}]},{"type":"element","tag":"pre","props":{"code":"let main_block = context.append_basic_block(main_function, \"entry\");\nbuilder.position_at_end(main_block);\n","language":"rust","meta":"","className":"language-rust shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" main_block "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"append_basic_block"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(main_function, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"entry\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"builder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"position_at_end"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(main_block);\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So a block is basically a part of code, a jump target if you will, these blocks are what you can use "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"goto"}]},{"type":"text","value":"/"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"jump"}]},{"type":"text","value":" to jump to.\nThey are how we structure "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":", loops, "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"switch"}]},{"type":"text","value":", etc. basically any form of branching/repeating code. We only need one block, the name doesn't really matter, all it does is help with debugging and reading the produced IR. But I would still recommend giving stuff good names for your own sake."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then we move the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"builder"}]},{"type":"text","value":" to the end of the (empty) block, this means when we use the builder methods the code will be generated in this block!"}]},{"type":"element","tag":"pre","props":{"code":"let string = builder.build_global_string_ptr(\"Hello World!\", \"output\");\nlet string = string.as_pointer_value();\n","language":"rust","meta":"","className":"language-rust shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" string "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" builder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"build_global_string_ptr"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"Hello World!\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"output\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" string "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"as_pointer_value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"here we create a global string, basically a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" and then convert it to a pointer ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"i8*"}]},{"type":"text","value":"), next we will construct the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"printf"}]},{"type":"text","value":" call. And again, the name doesn't matter!"}]},{"type":"element","tag":"pre","props":{"code":"builder.build_call(printf, &[string.into()], \"Print_Statement\");\n","language":"rust","meta":"","className":"language-rust shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"builder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"build_call"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(printf, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"[string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"into"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"()], "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"Print_Statement\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is very straightforward, we specify the function we wish to call, its arguments, and the name of the return value.\nNow our code is basically done except, for one thing, our "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"main()"}]},{"type":"text","value":" should return the exit code!"}]},{"type":"element","tag":"pre","props":{"code":"builder.build_return(Some(&i8_type.const_int(0, false)));\n","language":"rust","meta":"","className":"language-rust shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"builder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"build_return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"Some"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"i8_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"const_int"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":")));\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We create a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"const"}]},{"type":"text","value":" int of value 0 (meaning no errors), don't worry about the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"false"}]},{"type":"text","value":" it is to enable a feature we don't need."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And now our code is finally done, we just need to save it!"}]},{"type":"element","tag":"pre","props":{"code":"module.print_to_file(\"output.ll\").unwrap();\n","language":"rust","meta":"","className":"language-rust shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"print_to_file"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"output.ll\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"unwrap"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Our code should now look like this:"}]},{"type":"element","tag":"pre","props":{"code":"use inkwell::{context::Context, AddressSpace};\n\nfn main() {\n    let context = Context::create();\n    let module = context.create_module(\"hello world\");\n    let builder = context.create_builder();\n\n    let i8_type = context.i8_type();\n    let i8_ptr_type = i8_type.ptr_type(AddressSpace::default());\n    let i32_type = context.i32_type();\n\n    let printf_type = i32_type.fn_type(&[i8_ptr_type.into()], true);\n    let printf = module.add_function(\"printf\", printf_type, None);\n\n    let main_function_type = i8_type.fn_type(&[], false);\n    let main_function = module.add_function(\"main\", main_function_type, None);\n\n    let main_block = context.append_basic_block(main_function, \"entry\");\n    builder.position_at_end(main_block);\n\n    let string = builder.build_global_string_ptr(\"Hello World!\", \"output\");\n    let string = string.as_pointer_value();\n    builder.build_call(printf, &[string.into()], \"Print_Statement\");\n\n    builder.build_return(Some(&i8_type.const_int(0, false)));\n\n    module.print_to_file(\"output.ll\").unwrap();\n}\n","language":"rust","meta":"","className":"language-rust shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"use"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" inkwell"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"Context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"AddressSpace"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"fn"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" main"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" context "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":" Context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"create"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" module "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"create_module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"hello world\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" builder "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"create_builder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" i8_type "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"i8_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" i8_ptr_type "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" i8_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"ptr_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"AddressSpace"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"default"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"());\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" i32_type "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"i32_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" printf_type "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" i32_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"fn_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"[i8_ptr_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"into"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"()], "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"true"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" printf "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"add_function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"printf\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":", printf_type, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" main_function_type "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" i8_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"fn_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"[], "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" main_function "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"add_function"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"main\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":", main_function_type, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"None"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" main_block "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" context"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"append_basic_block"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(main_function, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"entry\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    builder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"position_at_end"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(main_block);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" string "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" builder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"build_global_string_ptr"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"Hello World!\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"output\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"    let"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" string "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"as_pointer_value"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    builder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"build_call"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"(printf, "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"[string"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"into"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"()], "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"Print_Statement\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    builder"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"build_return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"Some"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"&"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"i8_type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"const_int"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":")));\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"    module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"print_to_file"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"\"output.ll\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"unwrap"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"testing-our-work"},"children":[{"type":"text","value":"Testing our work"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If we now run this code we should get a "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"output.ll"}]},{"type":"text","value":" file in our output directory,  it should look something like this:"}]},{"type":"element","tag":"pre","props":{"code":"; ModuleID = 'hello world'\nsource_filename = \"hello world\"\n\n@output = private unnamed_addr constant [13 x i8] c\"Hello World!\\00\", align 1\n\ndeclare i32 @printf(ptr, ...)\n\ndefine i8 @main() {\nentry:\n  %Print_Statement = call i32 (ptr, ...) @printf(ptr @output)\n  ret i8 0\n}\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"; ModuleID = 'hello world'\nsource_filename = \"hello world\"\n\n@output = private unnamed_addr constant [13 x i8] c\"Hello World!\\00\", align 1\n\ndeclare i32 @printf(ptr, ...)\n\ndefine i8 @main() {\nentry:\n  %Print_Statement = call i32 (ptr, ...) @printf(ptr @output)\n  ret i8 0\n}\n"}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"if you are a VScode user you can use the following extension to get this syntax highligthed: "},{"type":"element","tag":"a","props":{"href":"https://marketplace.visualstudio.com/items?itemName=colejcummins.llvm-syntax-highlighting","rel":["nofollow"]},"children":[{"type":"text","value":"https://marketplace.visualstudio.com/items?itemName=colejcummins.llvm-syntax-highlighting"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now we can try to run this directly using LLVMs builtin interpreter, it is nice for quick testing!\nYou might need to add the LLVM bin directory to your path."}]},{"type":"element","tag":"pre","props":{"code":"export PATH=/home/USERNAME/.local/share/llvmenv/local-15/bin/:$PATH\nlli output.ll\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":" PATH"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":"/home/USERNAME/.local/share/llvmenv/local-15/bin/:"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E1E4E8"},"children":[{"type":"text","value":"$PATH\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"lli"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" output.ll\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You should see \"Hello World\" being printed on your terminal!\nBut this is a compiler, so let's make this into a binary, in the next post these steps will be added to your compiler itself!"}]},{"type":"element","tag":"pre","props":{"code":"llc output.ll -filetype=obj -o output.o\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"llc"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" output.ll"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" -filetype=obj"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" -o"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" output.o\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This will use the LLVM static compiler to compile your IR to an object file. An object file is basically almost a binary, it contains the assembly/machine code, but also symbol data, our code is converted into one object file, then a lot of object files are combined into one binary. This is how dependencies are added to your projects, it is also common to have each code file produce its own object file, it makes structuring the compiler easier. But ofc one issue we can run into is that we might have module scope with functions separated, but object files don't, so we need to handle that, but that is a future problem."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then we can use "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"clang"}]},{"type":"text","value":"/"},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"gcc"}]},{"type":"text","value":" to compile the object file into a binary"}]},{"type":"element","tag":"pre","props":{"code":"clang output.o -no-pie -o output\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"clang"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" output.o"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" -no-pie"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#79B8FF"},"children":[{"type":"text","value":" -o"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#9ECBFF"},"children":[{"type":"text","value":" output\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This will use "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"clang"}]},{"type":"text","value":" ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"or gcc"}]},{"type":"text","value":") to convert your object file to a final binary, "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"clang"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"gcc"}]},{"type":"text","value":" include libc by default so we don't have to worry about that. We also need to pass the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"-no-pie"}]},{"type":"text","value":" flag as the code we generate is not compatible with PIE binaries, because it uses absolute addresses."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We should now be able to run our binary!"}]},{"type":"element","tag":"pre","props":{"code":"./output\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#B392F0"},"children":[{"type":"text","value":"./output\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"and we should see the \"Hello World\" message!"}]},{"type":"element","tag":"h2","props":{"id":"conclusion"},"children":[{"type":"text","value":"Conclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you followed along then congratulations! You now have a very hardcoded compiler, but you generated a binary from scratch!\nIn the next post we will start laying out the code components of the compiler and start generting binaries based on a input script file "},{"type":"element","tag":"o","props":{},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you have any questions feel free to leave them in the comments "},{"type":"element","tag":"d","props":{},"children":[]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"the-goal","depth":3,"text":"The goal"},{"id":"assembly","depth":3,"text":"Assembly"},{"id":"llvm","depth":3,"text":"LLVM"},{"id":"overall-compiler-structure","depth":3,"text":"Overall compiler structure"},{"id":"so-lets-write-some-code","depth":2,"text":"So let's write some code!","children":[{"id":"installing-inkwell-and-llvm","depth":3,"text":"Installing inkwell and LLVM"},{"id":"hello-world","depth":3,"text":"Hello World"},{"id":"testing-our-work","depth":3,"text":"Testing our work"}]},{"id":"conclusion","depth":2,"text":"Conclusion"}]}},"_type":"markdown","_id":"content:blog:1.compiler_1.md","_source":"content","_file":"blog/1.compiler_1.md","_extension":"md"}